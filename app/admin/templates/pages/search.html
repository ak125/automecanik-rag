{% extends "base.html" %}
{% block title %}Search Test{% endblock %}
{% block content %}
<div class="space-y-4">
    <h1 class="text-2xl font-bold">Test Recherche</h1>
    <div class="bg-white rounded shadow p-4">
        <form id="search-form" class="flex gap-4">
            <input type="text" id="query" class="flex-1 rounded border-gray-300" placeholder="plaquettes frein usure">
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">Rechercher</button>
        </form>
    </div>
    <div id="results" class="space-y-2"><p class="text-gray-400 text-center py-8">Resultats ici...</p></div>
</div>
<script>
document.getElementById('search-form').onsubmit = async (e) => {
    e.preventDefault();
    const q = document.getElementById('query').value;
    if (!q) return;
    document.getElementById('results').innerHTML = '<p class="text-gray-400 text-center py-8">...</p>';
    try {
        const res = await fetch('/search', {method:'POST', headers:{'Content-Type':'application/json','X-API-Key':'dev'}, body:JSON.stringify({query:q,limit:10})});
        const data = await res.json();
        if (data.results?.length) {
            let h = '';
            data.results.forEach(r => {
                const c = {L1:'bg-green-500',L2:'bg-blue-500',L3:'bg-amber-500',L4:'bg-red-500'}[r.truth_level]||'bg-gray-500';
                h += '<div class="bg-white rounded shadow p-4"><div class="flex justify-between"><h3 class="font-semibold">'+r.title+'</h3><span class="px-2 py-0.5 rounded text-xs text-white '+c+'">'+r.truth_level+'</span></div><p class="text-sm text-gray-600 mt-2">'+(r.content||'').substring(0,150)+'...</p></div>';
            });
            document.getElementById('results').innerHTML = h;
        } else document.getElementById('results').innerHTML = '<p class="text-gray-400 text-center py-8">Aucun</p>';
    } catch (err) { document.getElementById('results').innerHTML = '<p class="text-red-600 text-center py-8">'+err+'</p>'; }
};
</script>
{% endblock %}
